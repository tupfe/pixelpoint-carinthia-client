<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Veranstaltungen in KÃ¤rnten</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 1.5rem;
      background: #f5f5f5;
    }

    h1 {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    #events {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.5rem;
    }

    .event-card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .event-card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      display: block;
    }

    .event-content {
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .event-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 0;
    }

    .event-meta {
      font-size: 0.9rem;
      color: #555;
    }

    .event-description {
      font-size: 0.9rem;
      color: #333;
    }

    .error {
      color: #b00020;
      text-align: center;
      margin-top: 1rem;
    }

    .loading {
      text-align: center;
      margin-top: 1rem;
      color: #555;
    }
  </style>
</head>
<body>
  <h1>Veranstaltungen in KÃ¤rnten</h1>

  <div id="status" class="loading">Veranstaltungen werden geladen â€¦</div>
  <div id="events"></div>

  <script>
    // ðŸ‘‰ DEINE API-URL HIER EINTRAGEN
    const API_URL = "https://data.carinthia.com/api/v4/endpoints/557ea81f-6d65-6476-9e01-d196112514d2?include=image&token=9962098a5f6c6ae8d16ad5aba95afee0";

    async function loadEvents() {
      const statusEl = document.getElementById("status");
      const eventsContainer = document.getElementById("events");

      try {
        const res = await fetch(API_URL);

        if (!res.ok) {
          throw new Error("HTTP-Fehler " + res.status);
        }

        const json = await res.json();

        // Debug: JSON in der Browser-Konsole anschauen
        console.log("API Response:", json);

        // ðŸ”§ Hier machen wir das mÃ¶glichst robust,
        // weil wir das genaue Format nicht kennen.
        let rawEvents;

        if (Array.isArray(json)) {
          rawEvents = json;
        } else if (Array.isArray(json.data)) {
          rawEvents = json.data;
        } else if (Array.isArray(json.items)) {
          rawEvents = json.items;
        } else {
          // Fallback: versuchen, das erste Array im Objekt zu finden
          const firstArrayKey = Object.keys(json).find(
            (key) => Array.isArray(json[key])
          );
          rawEvents = firstArrayKey ? json[firstArrayKey] : [];
        }

        if (!rawEvents || rawEvents.length === 0) {
          statusEl.textContent = "Keine Veranstaltungen gefunden.";
          return;
        }

        statusEl.textContent = ""; // Status ausblenden

        rawEvents.forEach((event) => {
          const card = createEventCard(event);
          eventsContainer.appendChild(card);
        });
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Fehler beim Laden der Veranstaltungen.";
        statusEl.className = "error";
      }
    }

    function createEventCard(ev) {
      const card = document.createElement("article");
      card.className = "event-card";

      // Title / Name (mehrere mÃ¶gliche Feldnamen)
      const title =
        ev.title ||
        ev.name ||
        ev.bezeichnung ||
        (ev.attributes && (ev.attributes.title || ev.attributes.name)) ||
        "Ohne Titel";

      // Beschreibung (optional, gekÃ¼rzt)
      const description =
        ev.description ||
        ev.beschreibung ||
        (ev.attributes && (ev.attributes.description || ev.attributes.beschreibung)) ||
        "";

      // Start-/Enddatum â€“ hier mehrere typische Varianten ausprobieren
      const startDateRaw =
        ev.startDate ||
        ev.start_date ||
        ev.beginn ||
        (ev.attributes && (ev.attributes.startDate || ev.attributes.beginn));

      const endDateRaw =
        ev.endDate ||
        ev.end_date ||
        ev.ende ||
        (ev.attributes && (ev.attributes.endDate || ev.attributes.ende));

      const locationName =
        ev.location ||
        ev.ort ||
        (ev.attributes && (ev.attributes.location || ev.attributes.ort)) ||
        "";

      // Bild-URL suchen (verschiedene mÃ¶gliche Strukturen)
      let imageUrl =
        (ev.image && (ev.image.url || ev.image.src)) ||
        ev.image_url ||
        (ev.images &&
          ev.images[0] &&
          (ev.images[0].url || ev.images[0].src)) ||
        (ev.attributes &&
          ev.attributes.image &&
          (ev.attributes.image.url || ev.attributes.image.src));

      // Wenn die API relative URLs liefert: eventuell Basis-URL voranstellen
      // const BASE_IMAGE_URL = "https://data.carinthia.com";
      // if (imageUrl && imageUrl.startsWith("/")) {
      //   imageUrl = BASE_IMAGE_URL + imageUrl;
      // }

      // Bild
      if (imageUrl) {
        const img = document.createElement("img");
        img.src = imageUrl;
        img.alt = title;
        card.appendChild(img);
      }

      const content = document.createElement("div");
      content.className = "event-content";

      const titleEl = document.createElement("h2");
      titleEl.className = "event-title";
      titleEl.textContent = title;
      content.appendChild(titleEl);

      // Meta-Infos (Datum + Ort)
      const metaParts = [];

      if (startDateRaw) {
        const start = formatDate(startDateRaw);
        if (endDateRaw) {
          const end = formatDate(endDateRaw);
          metaParts.push(start + " â€“ " + end);
        } else {
          metaParts.push(start);
        }
      }

      if (locationName) {
        metaParts.push(locationName);
      }

      if (metaParts.length > 0) {
        const metaEl = document.createElement("div");
        metaEl.className = "event-meta";
        metaEl.textContent = metaParts.join(" â€¢ ");
        content.appendChild(metaEl);
      }

      if (description) {
        const descEl = document.createElement("p");
        descEl.className = "event-description";
        descEl.textContent = truncate(description, 220);
        content.appendChild(descEl);
      }

      card.appendChild(content);
      return card;
    }

    function truncate(text, maxLength) {
      if (!text) return "";
      if (text.length <= maxLength) return text;
      return text.slice(0, maxLength).trim() + " â€¦";
    }

    function formatDate(value) {
      // Versuchen, Datum in ein Date-Objekt zu konvertieren
      const d = new Date(value);
      if (isNaN(d.getTime())) {
        // Wenn es kein gÃ¼ltiges Datum ist, Rohwert anzeigen
        return String(value);
      }
      return d.toLocaleDateString("de-AT", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
      });
    }

    document.addEventListener("DOMContentLoaded", loadEvents);
  </script>
</body>
</html>
